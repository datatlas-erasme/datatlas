# Datatlas

## Getting started

### Locally

```
npm install
cp .env.example .env
```

### Using **Docker**

```
cp .env.example .env
docker compose up
```

**Setup app `.env` :**

> See **app** [./apps/frontend/README.md](./apps/frontend/README.md).

## Development

### Ue docker for development

```
cp .env.example .env

docker-compose build 
docker rm dev-datatlas-node-modules
docker run --name dev-datatlas-node-modules -d --env-file .env dev-datatlas tail -f /dev/null 
docker cp dev-datatlas-node-modules:/datatlas/node_modules .
docker stop dev-datatlas-node-modules && docker rm dev-datatlas-node-modules
docker-compose up
```
No need to rerun all the command above for a second time, just run `docker-compose up` and it will start the containers.


**About .env file**
to get your user uid and gid run `id` in your terminal

### Code quality

Run `prettier` on whole repository:

```
nx format:write
```

Run `lint` on whole repository

```
nx run-many --target=lint
```

### Update dependencies

For example update `nestjs` :

```shell
npx npm-check-updates --filter "@nestjs/*" -u
```

Or to update `mikro-orm` :

```
npx npm-check-updates --filter "@mikro-orm/*" -u
```

### Test

Run a single test file:

```
npx nx run backend-e2e:e2e --spec apps/backend-e2e/src/e2e/user.cy.ts
```

https://github.com/cypress-io/cypress/issues/2610#issuecomment-1319738814

#### Cypress

https://github.com/nrwl/nx/tree/master/packages/cypress/docs

### Backend

```
nx serve backend
```

> Navigate to http://localhost:4200/. The app will automatically reload if you change any of the source files.

#### Swagger

You can reach swagger and see all the API routes at http://localhost:3333/api/

Please note that most routes require an authentication. Reach it out via this route `/api/auth/login` and
sending this body :

```json
{
  "email": "your_email",
  "password": "your-password"
}
```

Those credentials are the one you should have put in your `.env` file.

## Design

**Figma** sketch :
`https://www.figma.com/proto/lVX7Lycox3AGixBhhbhQsQ/DatAtlas`

> _Made by [SiaPartners](https://www.sia-partners.com/)._

## nx

<a href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, a Smart, fast and extensible build system.](https://nx.dev)** ✨

### Understand this workspace

Run `nx graph` to see a diagram of the dependencies of the projects.

### Further help

Visit the [Nx Documentation](https://nx.dev) to learn more.

### Troubleshooting

#### pgpass on my local machine does not automaticly connect to datatlas postgres database

The mounted pgpass file should have 0600 permissions. If not, pgpass will ignore it.
`chmod 0600 docker/pgadmin/pgpass`
